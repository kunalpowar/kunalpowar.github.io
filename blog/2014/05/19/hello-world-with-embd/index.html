
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->

<head>


<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">

<title>Hello World With EMBD - This and That</title>
<meta name="author" content="Kunal Powar">




<meta name="description" content="Dumping ground for random blogs that i come up with :P">

<meta name="keywords" content="embd, tech, golang, embedded ">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Twitter Cards -->

  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content"">
  
  <meta name="twitter:title" content="Hello world with EMBD">
  <meta name="twitter:description" content="Dumping ground for random blogs that i come up with :P">
  <meta name="twitter:creator" content="@_poWar_">


<!-- Open Graph -->
<meta property="og:local" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="http://kunalpowar.github.io/blog/2014/05/19/hello-world-with-embd">
<meta property="og:title" content="Hello world with EMBD">
<meta property="og:description" content="Dumping ground for random blogs that i come up with :P">

  <meta property="og:image" content="">

<meta property="og:site_name" content="This and That">

<link rel="canonical" href="http://kunalpowar.github.io/blog/2014/05/19/hello-world-with-embd">
<link href="/favicon.png" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/atom.xml" rel="alternate" title="This and That" type="application/atom+xml">

<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
<script>Modernizr || document.write('<script src="/javascripts/vendor/modernizr-2.6.2.custom.min.js"><\/script>') </script>


  
      
  

  
    
  

  <style type="text/css">body {background-image:url(/images//images/background.jpeg);}</style>


<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/profile.jpeg" alt="Kunal Powar photo" class="author-photo">
					<h4>Kunal Powar</h4>
					<p>Developer at Sostronk (www.sostronk.com). Gaming, biking, star gazing (the ones in the sky) and trekking are few other stuff i do. &#8220;I rarely blog, but when i do, i do them at once&#8221;</p>
				</li>
				
				<li>
					<a href="mailto:kunalpowar1203@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/_poWar_"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://github.com/kunalpowar"><i class="fa fa-github"></i> GitHub</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/categories/">All Categories</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/blog/2014/05/19/hello-world-with-embd/" rel="bookmark" title="Hello world with EMBD">Hello world with EMBD</a></h1>
        
        <h2>May 19, 2014</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <h3>A Little Story</h3>

<p>Here we are, one of the usual night outs, hacking on a raspberry pi to get it working towards <a href="http://kidoman.io/engineering/thebot.html">the bot</a> idea. Started with one blinking led and then 4. Why 4? We thought if we are able to control 4 leds, then we can expand it to a 4wire parallel communication based on sending nibbles of data. With the poor pi giving us just 9 usable GPIO&rsquo;s this became a big problem. How do we interface those 10s of sensors? In comes I2C, a well-known hardware communication protocol, which uses just two wires and can talk to 128 individual devices. Now we didn&rsquo;t have an appetite to use existing C or python based libraries to talk I2C. Instead we wanted to write our own in golang. To get us started we got hold of an incomplete implementation of the protocol written in golang, which we picked up and started developing on. Thus came our first library solely containing I2C implementation. The trend continued by writing more and more such libraries right from the basic GPIO operations to interfacing with various sensors available in the market. As theoretically predicted, few of the libraries worked without any code change on beagle bone, another awesome prototyping board based on Linux.  After this, many &ldquo;nights&rdquo; were spent to make the library smart enough to work on any Linux based prototyping boards without any code change.  Thus was born the superheroic framework &ldquo;EMBD&rdquo;.</p>

<p>To get you started with EMBD, lets cook up a famous &ldquo;hello world&rdquo; (of the hardware world) recipe.</p>

<h3>Ingredients Required</h3>

<ul>
<li>1 EMBD</li>
<li>1 led</li>
<li>1 Raspberry pi</li>
<li>Few wires</li>
<li>Breadboard</li>
<li>Fire extinguisher (incase you decide to short the + and -)</li>
<li>1 Sublime Text Editor (personal favorite)</li>
</ul>


<p>At the end of the article is a video depicting the complete process. But i&rsquo;d recommend to read through before jumping to it. I&rsquo;ll not be talking much about the language itself here, but you can refer this to get you started with golang. One of the most compelling reasons for choosing golang for EMBD was its cross compatibility. ARM being one of the fully supported architectures, it suits well for most of the prototyping boards. Meaning you can code on any golang development friendly machine and then build for any target. Follow the instructions here to setup golang on your machine.
The all important hardware setup
Before you start with coding, lets see how to setup the hardware. In any project where you use a prototype board, its a good practice to keep the board and the external circuit separate. So we&rsquo;ll be using a breadboard to connect our led to the pi. Might seem like an overkill, but its &ldquo;good practice&rdquo;. Fix the led on the breadboard and before you do so make a note of the -ve and +ve terminals. (How you ask? the longer of the leads is +ve). Connect the -ve side to ground pin(3rd from top right on the pin header), and the +ve to the 4th pin from top left of the pin header. This is pin 4, which will be driving the led. Now power up your pi (via USB or external source), and get an ssh access to it on your host machine.</p>

<h3>Some Electronics</h3>

<p>At the core of the pi lies a ARM11 processor. But the processor alone does not provide many peripherals which are a must for any prototyping board. This is done using BCM2835 ARM Peripherals chip. It provides all the awesome features like SPI, I2C, GPIO, HDMI, USB etc. We&rsquo;ll be using the GPIO feature here. What&rsquo;s GPIO?  General Purpose Input Output. Simply put, it exposes certain pins on the board whose behavior can be controlled. Behaviors like the pin acting as an output and giving +3.3V(logic high) or 0V(logic low) the voltages vary according to boards.</p>

<p>This example tries to light up a led (light emitting diode) connected to a pin on raspberry pi. What does it take to light up led&rsquo;s?&hellip;. a lil EMBD flare..</p>

<h3>Lets code&hellip;</h3>

<p>Create a led_blink.go file and copy the code as shown below. I&rsquo;d recommend using Sublime Text + GoSublime package.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;fmt&quot;</span>
</span><span class='line'>  <span class="s">&quot;time&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="s">&quot;github.com/kidoman/embd&quot;</span>
</span><span class='line'>  <span class="nx">_</span> <span class="s">&quot;github.com/kidoman/embd/host/rpi&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">embd</span><span class="p">.</span><span class="nx">InitGPIO</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">defer</span> <span class="nx">embd</span><span class="p">.</span><span class="nx">CloseGPIO</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">ledPinNum</span> <span class="o">:=</span> <span class="mi">4</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">led</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">embd</span><span class="p">.</span><span class="nx">NewDigitalPin</span><span class="p">(</span><span class="nx">ledPinNum</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">err</span> <span class="p">=</span> <span class="nx">led</span><span class="p">.</span><span class="nx">SetDirection</span><span class="p">(</span><span class="nx">embd</span><span class="p">.</span><span class="nx">Out</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">defer</span> <span class="nx">led</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;setting led at %v to high\n&quot;</span><span class="p">,</span> <span class="nx">ledPinNum</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">led</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">embd</span><span class="p">.</span><span class="nx">High</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;setting led at %v to low\n&quot;</span><span class="p">,</span> <span class="nx">ledPinNum</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">led</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">embd</span><span class="p">.</span><span class="nx">Low</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al right, we have the code. Lets see what it does in more detail.</p>

<p>Here all the necessary packages are imported, embd being the most important. embd also provides packages for hosts like rpi and bbb. In this example we import the rpi package. The underscore tells go to import this even though its not directly used in the code.</p>

<h4><em>embd.InitGPIO()</em></h4>

<p>This tries to get the board info. Why you ask? EMBD supports multiple prototyping platforms. The same code can work on a different LINUX based boards like radxa, beagle bone etc.  The board info is then used to access the corresponding drivers for GPIO control</p>

<h4><em>embd.CloseGPIO()</em></h4>

<p>This command handles the very important clean up once the program exits.</p>

<h4><em>embd.NewDigitalPin(ledPInNum)</em></h4>

<p>This is where all the magic happens. In LINUX everything is a file or dir. And so is a pin. This command uses a gpio exporter to access a directory (/sys/class/gpio/gpio4 in this case). This directory corresponds to the physical pin on the board, and has various files for supported pin functionalities. It returns an interface (led in this case) which has methods to control the behavior of the pin. It returns an error if any.</p>

<h4><em>led.SetDirection(embd.Out)</em></h4>

<p>This is one of the functions implemented by &ldquo;led&rdquo; interface that sets up the pin to be a output or input. <em><strong>embd.Out</strong></em> is used when you want to drive anything connected to the pin (led in this case), and <em><strong>embd.In</strong></em> is used when the input has to be read (eg: reading a switch state).</p>

<h4><em>led.Write(embd.High) / led.Write(embd.Low)</em></h4>

<p>This functions writes 1 or 0 to the value file within the pin&rsquo;s directory. This results in the corresponding pin giving a HIGH (3.3V) or 0V output respectively. <em><strong>embd.High</strong></em> and <em><strong>embd.Low</strong></em> are a types referring to 1 and 0 respectively.</p>

<p>Now that you know what is happening, lets build the code so that our awaiting led gets its deserved light. As mentioned earlier, go supports cross compiling. A Raspberry pi has ARM architecture and LINUX os, both supported by golang. To build a executable you need to set the variables GOARCH and GOOS on your terminal as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">GOARCH</span><span class="o">=</span>arm <span class="nv">GOOS</span><span class="o">=</span>linux go build led_blink.go
</span></code></pre></td></tr></table></div></figure>


<p>This should dump a led_blink executable in the same directory as the code. scp this executable onto your raspberry pi and run it as sudo user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scp led_blink pi@&lt;ip&gt;:~
</span><span class='line'>sudo ./led_blink
</span></code></pre></td></tr></table></div></figure>


<p>Voila..!!!!! The led springs up to life blinking every second. There&rsquo;s your  first ever implementation of embedded programming using EMBD.</p>

<div class="embed-video-container"><iframe src="//player.vimeo.com/video/93421433"></iframe></div>


<h3>What&rsquo;s Next..??</h3>

<p>Take further look at EMBD, and find more exciting samples to experiment on. What do you know&hellip;? One day you might be writing a new feature yourself and send in the pull requests. We are waiting&hellip;</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/categories/#embd," title="Pages tagged embd," class="tag">embd,</a><a href="/categories/#tech," title="Pages tagged tech," class="tag">tech,</a><a href="/categories/#golang," title="Pages tagged golang," class="tag">golang,</a><a href="/categories/#embedded" title="Pages tagged embedded" class="tag">embedded</a></span>
        <span><a href="/blog/2014/05/19/hello-world-with-embd/" rel="bookmark" title="Hello world with EMBD">Hello world with EMBD</a> was published on <span class="entry-date date published updated"><time datetime="2014-05-19T17:27:17+05:30">May 19, 2014</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="" title="About Kunal Powar">Kunal Powar</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    
      <div class="read-more">
        
          <div class="read-more-header">
            <a href="/blog/2015/02/28/stargazing/" class="btn">Read More</a>
          </div><!-- /.read-more-header -->
          <div class="read-more-content">
            <h3><a href="/blog/2015/02/28/stargazing/" title="Stargazing?">Stargazing?</a></h3>
            <p>##&#8221;I Like Stargazing&#8221;_So you are basically a huge follower of Hollywood stars?_  _Whoa it sounds so cool? what exactly do you do?_  _Is &hellip;&hellip; <a href="/blog/2015/02/28/stargazing/"> Continue reading</a></p>
          </div><!-- /.read-more-content -->
        
        <div class="read-more-list">
          
            <div class="list-item">
              <h4><a href="/blog/2014/05/22/spi-with-embd/" title="SPI with EMBD">SPI with EMBD</a></h4>
              <span>Published on May 22, 2014</span>
            </div><!-- /.list-item -->
          
        </div><!-- /.read-more-list -->
      </div><!-- /.read-more -->
    
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Kunal Powar. Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/jez/hpstr-theme/">HPSTR Theme for Octopress</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->


	        
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/javascripts/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>
<script src="/javascripts/scripts.min.js"></script>




<script type="text/javascript">
      var disqus_shortname = 'powario1203';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kunalpowar.github.io/blog/2014/05/19/hello-world-with-embd/';
        var disqus_url = 'http://kunalpowar.github.io/blog/2014/05/19/hello-world-with-embd/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


	        

</body>
</html>
